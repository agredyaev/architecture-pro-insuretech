# ADR-0001 - Архитектурные решения Task1

Дата: 2026-01-31
Статус: Принято

## Контекст
Требования: доступность 99,9%; RTO ≤ 45 мин; RPO ≤ 15 мин; маршрутизация пользователей РФ на регион с успешным health check. Объём данных ~50 GB.

## Требования

| ID | Формулировка требования | Обоснование | Способ проверки |
|---|---|---|---|
| REQ-ADR-001 | Система SHALL направлять трафик в регион West в штатном режиме; регион East SHALL принимать трафик при недоступности West. | Multi-region active + DR обеспечивает доступность 99,9% и RTO ≤ 45 мин. | Инспекция архитектурной схемы и конфигурации DNS. |
| REQ-ADR-002 | GeoDNS SHALL направлять запросы в регион с успешным L7 /healthz; переключение SHALL выполняться за время ≤ RTO 45 мин. | L7 health checks гарантируют готовность приложения перед маршрутизацией. | Тест сценариев failover; измерение времени переключения. |
| REQ-ADR-003 | Каждый регион SHALL использовать отдельный Kubernetes-кластер (non-stretched) с multi-AZ; масштабирование SHALL выполняться через HPA + Cluster Autoscaler; вертикальное масштабирование SHALL выполняться через размер нод. | Независимые кластеры изолируют отказы между регионами (требование 2a). | Проверка конфигурации кластера; инспекция настроек autoscaler. |
| REQ-ADR-004 | База данных SHALL использовать синхронную репликацию внутри региона и асинхронную реплику в DR; PITR-резервные копии SHALL храниться в Object Storage; RPO ≤ 15 мин, RTO ≤ 45 мин. | Синхронная репликация защищает от отказов нод; асинхронная DR и PITR соответствуют RPO/RTO. | Проверка задержки репликации; тест восстановления PITR; измерение времени восстановления. |
| REQ-ADR-005 | База данных SHALL NOT реализовывать шардирование при объёме данных ~50 GB. | Объём данных не требует шардинга; сложность превышает пользу при данном масштабе. | Проверка конфигурации базы данных; подтверждение отсутствия шардинга. |

## Обоснование
- **Независимые кластеры (REQ-ADR-003):** исключают межрегиональные зависимости при отказах и соответствуют требованию 2a из задания (обоснование выбора independent vs stretched).
- **GeoDNS + L7 health checks (REQ-ADR-002):** обеспечивают переключение трафика в пределах RTO ≤ 45 мин.
- **Репликация и PITR (REQ-ADR-004):** обеспечивают RPO ≤ 15 мин и RTO ≤ 45 мин.
- **Объём 50 GB (REQ-ADR-005):** не требует шардинга.

## Последствия
- Требуется мониторинг репликации и документированные DR-процедуры.
- GeoDNS и health checks должны поддерживать SLA 99,9%.
